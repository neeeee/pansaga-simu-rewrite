<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill System and Equipment Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .equipment-info { margin: 10px 0; padding: 5px; background: #f0f0f0; }
        .set-bonus { margin: 10px 0; padding: 5px; background: #e0f0e0; }
        .skill-info { margin: 10px 0; padding: 5px; background: #f0f0f0; }
        .skill-test { margin: 10px 0; padding: 10px; background: #e8f4f8; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Skill System and Equipment Test</h1>
    
    <div class="test-section">
        <h2>Skill System Test</h2>
        <label for="job-select">Select Job:</label>
        <select id="job-select">
            <option value="0">Warrior</option>
            <option value="1">Gladiator</option>
            <option value="2">Juggernaut</option>
            <option value="19">Monk</option>
            <option value="27">Shadowblade</option>
        </select>
        <button onclick="testSkills()">Test Skills</button>
        <div id="skill-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Derived Stats Test</h2>
        <p>This tests the calculation and display of all derived stats:</p>
        <div id="derived-stats-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Reset Functionality Test</h2>
        <p>This tests the reset buttons for status points and ability points:</p>
        <div id="reset-test-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Stat Input System Test</h2>
        <p>This tests the new stat input system where inputs show total stats (racial base + additional points):</p>
        <div id="stat-test-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Equipment Data</h2>
        <div id="equipment-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Set Bonuses</h2>
        <div id="set-bonus-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Equipment Dropdown Test</h2>
        <label for="weapon-select">Weapon:</label>
        <select id="weapon-select"></select><br><br>
        
        <label for="head-select">Head:</label>
        <select id="head-select"></select><br><br>
        
        <label for="torso-select">Torso:</label>
        <select id="torso-select"></select><br><br>
        
        <button onclick="testSetBonus()">Test Set Bonus</button>
        <div id="set-bonus-test"></div>
    </div>

    <script type="module">
        import { skills } from "./jobSkillValues.js";
        import { items } from "./equipData.js";
        import { setBonuses } from "./setBonuses.js";
        
        // Test skill data
        window.testSkills = function() {
            const jobId = parseInt(document.getElementById('job-select').value);
            const jobSkillData = skills[jobId];
            const output = document.getElementById('skill-output');
            
            if (!jobSkillData) {
                output.innerHTML = '<p>No skill data found for job ID ' + jobId + '</p>';
                return;
            }
            
            let html = '<h3>Job: ' + jobSkillData.name + '</h3>';
            
            for (const categoryId in jobSkillData) {
                if (categoryId === 'name') continue;
                
                const category = jobSkillData[categoryId];
                html += '<div class="skill-info">';
                html += '<h4>Category: ' + category.name + '</h4>';
                
                for (const skill of category.skills) {
                    html += '<p>Skill: ' + skill.name + ' (ID: ' + skill.id + ') - Min Adeptness: ' + skill.minAdeptness + ', Max Potential: ' + skill.maxPotential + '</p>';
                }
                html += '</div>';
            }
            
            // Add a test for skill point application
            html += '<div class="skill-test">';
            html += '<h4>Skill Point Test:</h4>';
            html += '<p>This simulates what happens when you spend skill points:</p>';
            
            // Simulate character state
            const character = {
                skills: {},
                jobId: jobId
            };
            
            // Initialize skills with base values
            for (const categoryId in jobSkillData) {
                if (categoryId === 'name') continue;
                const category = jobSkillData[categoryId];
                for (const skillData of category.skills) {
                    character.skills[skillData.id] = {
                        adeptness: skillData.minAdeptness,
                        potential: skillData.minAdeptness, // Start with base adeptness
                    };
                }
            }
            
            // Simulate spending some skill points
            const testSkillId = 20; // Dark skill
            if (character.skills[testSkillId]) {
                const originalAdeptness = character.skills[testSkillId].adeptness;
                
                // Simulate adding 5 points to adeptness (1 point per level)
                character.skills[testSkillId].adeptness = originalAdeptness + 5;
                
                html += '<p><strong>Dark Skill Test:</strong></p>';
                html += '<p>Original: ' + originalAdeptness + '/' + jobSkillData[17].skills.find(s => s.id === testSkillId)?.maxPotential + '</p>';
                html += '<p>After spending 5 points: ' + character.skills[testSkillId].adeptness + '/' + jobSkillData[17].skills.find(s => s.id === testSkillId)?.maxPotential + '</p>';
                html += '<p>Cost: 1 skill point per level increase</p>';
                html += '<p>Max potential for this job: ' + jobSkillData[17].skills.find(s => s.id === testSkillId)?.maxPotential + '</p>';
            }
            
            html += '</div>';
            
            output.innerHTML = html;
        };
        
        // Test equipment data
        function testEquipment() {
            const output = document.getElementById('equipment-output');
            let html = '<h3>Available Equipment:</h3>';
            
            for (const [itemId, item] of Object.entries(items)) {
                html += '<div class="equipment-info">';
                html += '<strong>' + item.name + '</strong> (ID: ' + itemId + ')<br>';
                html += 'Slot: ' + item.slot + '<br>';
                if (item.stats) {
                    html += 'Stats: ' + Object.entries(item.stats).map(([stat, value]) => stat + ': ' + value).join(', ');
                }
                html += '</div>';
            }
            
            output.innerHTML = html;
        }
        
        // Test set bonuses
        function testSetBonuses() {
            const output = document.getElementById('set-bonus-output');
            let html = '<h3>Available Set Bonuses:</h3>';
            
            for (const set of setBonuses) {
                html += '<div class="set-bonus">';
                html += '<strong>' + set.name + '</strong><br>';
                html += 'Required Items: ' + set.requiredItems.join(', ') + '<br>';
                html += 'Bonus: ' + set.bonus.description + '<br>';
                html += 'Stats: ' + Object.entries(set.bonus.stats).map(([stat, value]) => stat + ': ' + value).join(', ');
                html += '</div>';
            }
            
            output.innerHTML = html;
        }
        
        // Populate equipment dropdowns
        function populateDropdowns() {
            const itemsBySlot = {};
            for (const item of Object.values(items)) {
                if (!itemsBySlot[item.slot]) itemsBySlot[item.slot] = [];
                itemsBySlot[item.slot].push(item);
            }
            
            const weaponSelect = document.getElementById('weapon-select');
            const headSelect = document.getElementById('head-select');
            const torsoSelect = document.getElementById('torso-select');
            
            if (itemsBySlot.weapon) {
                weaponSelect.innerHTML = itemsBySlot.weapon
                    .map(item => `<option value="${item.id}">${item.name}</option>`)
                    .join('');
            }
            
            if (itemsBySlot.head) {
                headSelect.innerHTML = itemsBySlot.head
                    .map(item => `<option value="${item.id}">${item.name}</option>`)
                    .join('');
            }
            
            if (itemsBySlot.torso) {
                torsoSelect.innerHTML = itemsBySlot.torso
                    .map(item => `<option value="${item.id}">${item.name}</option>`)
                    .join('');
            }
        }
        
        // Test set bonus detection
        window.testSetBonus = function() {
            const weaponId = document.getElementById('weapon-select').value;
            const headId = document.getElementById('head-select').value;
            const torsoId = document.getElementById('torso-select').value;
            
            const equippedItems = [weaponId, headId, torsoId];
            const output = document.getElementById('set-bonus-test');
            
            let html = '<h4>Current Equipment:</h4>';
            html += '<p>Weapon: ' + (items[weaponId]?.name || 'None') + '</p>';
            html += '<p>Head: ' + (items[headId]?.name || 'None') + '</p>';
            html += '<p>Torso: ' + (items[torsoId]?.name || 'None') + '</p>';
            
            html += '<h4>Active Set Bonuses:</h4>';
            let activeBonuses = [];
            
            for (const set of setBonuses) {
                const hasAllItems = set.requiredItems.every(itemId => equippedItems.includes(itemId));
                if (hasAllItems) {
                    activeBonuses.push(set);
                    html += '<div class="set-bonus">';
                    html += '<strong>' + set.name + '</strong><br>';
                    html += set.bonus.description;
                    html += '</div>';
                }
            }
            
            if (activeBonuses.length === 0) {
                html += '<p>No set bonuses active.</p>';
            }
            
            output.innerHTML = html;
        };
        
        // Test derived stats
        function testDerivedStats() {
            const output = document.getElementById('derived-stats-output');
            let html = '<h3>Derived Stats Calculation:</h3>';
            
            html += '<h4>Core Stats (LP, MP, ATK, DEF, MATK):</h4>';
            html += '<p><strong>LP:</strong> Base + Level component + STA multiplier</p>';
            html += '<p><strong>MP:</strong> Base + Level component + SPR multiplier</p>';
            html += '<p><strong>ATK:</strong> STR/2 + Weapon ATK</p>';
            html += '<p><strong>DEF:</strong> Sum of equipment DEF values</p>';
            html += '<p><strong>MATK:</strong> Base 100 + INT bonus (0.376% per point above 4) + Job/Weapon bonuses + Elemental proficiency (0.106% per point)</p>';
            
            html += '<h4>Combat Stats:</h4>';
            html += '<p><strong>Front/Back ATK:</strong> Base ATK with position multipliers</p>';
            html += '<p><strong>Front/Back DEF:</strong> Base DEF with position multipliers</p>';
            html += '<p><strong>Accuracy:</strong> Level + DEX</p>';
            html += '<p><strong>Dodge:</strong> Level + AGI + AGI bonus</p>';
            html += '<p><strong>Critical:</strong> 1% + DEX/10</p>';
            
            html += '<h4>Resistance & Evasion:</h4>';
            html += '<p><strong>Physical/Magical Resistance:</strong> Based on DEF/SPR</p>';
            html += '<p><strong>Melee/Range/Magic Evasion:</strong> Dodge with type modifiers</p>';
            html += '<p><strong>Critical Resistance:</strong> Based on AGI</p>';
            
            html += '<h4>Speed & Movement:</h4>';
            html += '<p><strong>Attack Speed:</strong> AGI/2</p>';
            html += '<p><strong>Cast Speed:</strong> +5% per 10 DEX</p>';
            html += '<p><strong>Movement Speed:</strong> Base 100 (modified by gear only)</p>';
            html += '<p><strong>Town Movement:</strong> 1.5x normal speed</p>';
            
            html += '<h4>Utility Stats:</h4>';
            html += '<p><strong>POT:</strong> Level*2 + STA/2</p>';
            html += '<p><strong>LP Heal:</strong> SPR/2 (healing percentage)</p>';
            html += '<p><strong>Red MP:</strong> SPR/3 (MP regeneration)</p>';
            html += '<p><strong>Cooldown:</strong> -2% every 10 INT (base 100%)</p>';
            
            html += '<h4>Elemental Resistances:</h4>';
            html += '<p><strong>Fire/Ice/Thunder/Poison/Charm/Light:</strong> Base 0, modified by equipment</p>';
            
            output.innerHTML = html;
        }
        
        // Test reset functionality
        function testResetFunctionality() {
            const output = document.getElementById('reset-test-output');
            let html = '<h3>Reset Functionality:</h3>';
            
            html += '<h4>Status Point Reset:</h4>';
            html += '<p><strong>Function:</strong> resetStatusPoints()</p>';
            html += '<p><strong>Behavior:</strong> Resets all additional stat points to 0, leaving only racial base + job modifiers</p>';
            html += '<p><strong>Example:</strong> Human Warrior with +10 STR → Reset → Human Warrior with base STR only</p>';
            
            html += '<h4>Ability Point Reset:</h4>';
            html += '<p><strong>Function:</strong> resetAbilityPoints()</p>';
            html += '<p><strong>Behavior:</strong> Resets all skill adeptness to job base values (minAdeptness)</p>';
            html += '<p><strong>Example:</strong> Monk with 50 Bash → Reset → Monk with base Bash level</p>';
            
            html += '<h4>Usage:</h4>';
            html += '<p><strong>Job Changes:</strong> Use reset buttons when switching jobs to avoid manually reducing stats</p>';
            html += '<p><strong>Clean Slate:</strong> Use reset buttons to start fresh with current race/job</p>';
            html += '<p><strong>Point Recovery:</strong> Reset buttons refund all spent points back to available pool</p>';
            
            output.innerHTML = html;
        }
        
        // Test stat input system
        function testStatSystem() {
            const output = document.getElementById('stat-test-output');
            let html = '<h3>Stat Input System:</h3>';
            
            // Test with Human Monk (race 0, job 19)
            const raceStats = { sta: 4, str: 7, agi: 4, dex: 5, spr: 6, int: 7 }; // Human
            const jobModifiers = { sta: 0, str: 2, agi: -1, dex: 0, spr: 1, int: 2 }; // Acolyte-type
            const additionalStats = { sta: 10, str: 15, agi: 8, dex: 12, spr: 20, int: 18 }; // Example additional points
            
            html += '<h4>Human Monk Example:</h4>';
            html += '<p><strong>Racial Base Stats:</strong> STA: 4, STR: 7, AGI: 4, DEX: 5, SPR: 6, INT: 7</p>';
            html += '<p><strong>Job Modifiers (Acolyte-type):</strong> STA: +0, STR: +2, AGI: -1, DEX: +0, SPR: +1, INT: +2</p>';
            html += '<p><strong>Additional Points:</strong> STA: +10, STR: +15, AGI: +8, DEX: +12, SPR: +20, INT: +18</p>';
            
            html += '<h4>Human Monk (With Job Modifiers):</h4>';
            for (const stat of ['sta', 'str', 'agi', 'dex', 'spr', 'int']) {
                const baseStat = raceStats[stat] + jobModifiers[stat]; // Job modifiers always apply
                const totalStat = baseStat + additionalStats[stat];
                html += `<p><strong>${stat.toUpperCase()}:</strong> ${totalStat} (${baseStat} base + ${additionalStats[stat]} additional)</p>`;
            }
            
            html += '<h4>Job Change Examples:</h4>';
            html += '<p><strong>Human Warrior:</strong> STA: 6, STR: 10, AGI: 3, DEX: 6, SPR: 5, INT: 7</p>';
            html += '<p><strong>Human Scout:</strong> STA: 4, STR: 9, AGI: 5, DEX: 7, SPR: 5, INT: 7</p>';
            html += '<p><strong>Human Acolyte:</strong> STA: 4, STR: 9, AGI: 3, DEX: 5, SPR: 7, INT: 9</p>';
            html += '<p><strong>Human Mage:</strong> STA: 3, STR: 8, AGI: 3, DEX: 6, SPR: 7, INT: 10</p>';
            
            html += '<h4>Minimum Validation:</h4>';
            html += '<p><strong>Input Field Min Attributes:</strong> Each input field has min="baseStat" to prevent going below racial base + job modifier</p>';
            html += '<p><strong>JavaScript Validation:</strong> readInputs() function enforces minimum values and updates input fields if they go below minimum</p>';
            html += '<p><strong>Job Change Behavior:</strong> When job changes, input fields automatically update to reflect new job modifiers</p>';
            
            output.innerHTML = html;
        }
        
        // Initialize on load
        testSkills();
        testDerivedStats();
        testResetFunctionality();
        testStatSystem();
        testEquipment();
        testSetBonuses();
        populateDropdowns();
    </script>
</body>
</html> 